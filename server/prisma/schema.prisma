generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id               String            @id @default(cuid())
  name             String            @unique @db.VarChar(35)
  email            String            @unique @db.VarChar(512)
  password         String            @db.VarChar(1024)
  details          String            @default("") @db.VarChar(512)
  avatar           String            @default("/default-avatar.svg") @db.VarChar(150)
  activity         String            @default("Online") @db.VarChar(25)
  likes            Int               @default(0)
  suggestions      Boolean           @default(false)
  verified         Boolean           @default(false)
  blockedUsers     BlockedUser[]
  comments         Comment[]
  communities      Community[]
  communityMembers CommunityMember[]
  followers        Follower[]
  friends          Friend[]
  messages         Message[]
  posts            Post[]
  openDMs          DM[]
  interests        Interest[]

  @@map("user")
}

model Follower {
  id     String @id @default(cuid())
  userID String
  user   User   @relation(fields: [userID], references: [id])

  @@index([userID], map: "follower_userID_fkey")
  @@map("follower")
}

model BlockedUser {
  id     String @id @default(cuid())
  userID String
  user   User   @relation(fields: [userID], references: [id])

  @@index([userID], map: "blocked_user_userID_fkey")
  @@map("blocked_user")
}

model Friend {
  id     String @id @default(cuid())
  userID String
  user   User   @relation(fields: [userID], references: [id])

  @@index([userID], map: "friend_userID_fkey")
  @@map("friend")
}

model CommunityMember {
  id          String    @id @default(cuid())
  nickname    String?
  communityID String
  userID      String
  community   Community @relation(fields: [communityID], references: [id])
  user        User      @relation(fields: [userID], references: [id])

  @@index([communityID], map: "community_member_communityID_fkey")
  @@index([userID], map: "community_member_userID_fkey")
  @@map("community_member")
}

model Community {
  id       String            @id @default(cuid())
  title    String            @unique @db.VarChar(35)
  details  String            @db.VarChar(512)
  memberID String?
  member   User?             @relation(fields: [memberID], references: [id])
  members  CommunityMember[]
  posts    Post[]

  @@index([memberID], map: "community_memberID_fkey")
  @@map("community")
}

model Post {
  id          String    @id @default(cuid())
  title       String    @db.VarChar(150)
  body        String?   @db.VarChar(800)
  likes       Int
  userID      String
  communityID String
  community   Community @relation(fields: [communityID], references: [id])
  user        User      @relation(fields: [userID], references: [id])
  comments    Comment[]
  images      Image[]
  videos      Video[]

  @@index([communityID], map: "post_communityID_fkey")
  @@index([userID], map: "post_userID_fkey")
  @@map("post")
}

model Image {
  id      String  @id @default(cuid())
  url     String? @db.VarChar(255)
  caption String? @db.VarChar(150)
  alt     String? @db.VarChar(150)
  postID  String?
  post    Post?   @relation(fields: [postID], references: [id])

  @@index([postID], map: "image_postID_fkey")
  @@map("image")
}

model Video {
  id      String  @id @default(cuid())
  url     String? @db.VarChar(255)
  caption String? @db.VarChar(150)
  alt     String? @db.VarChar(150)
  postID  String?
  post    Post?   @relation(fields: [postID], references: [id])

  @@index([postID], map: "video_postID_fkey")
  @@map("video")
}

model Interest {
  id    String @id @default(cuid())
  name  String @unique @db.VarChar(35)
  users User[]

  @@map("interest")
}

model DM {
  id       String    @id @default(cuid())
  messages Message[]
  users    User[]

  @@map("dm")
}

model Message {
  id              String     @id @default(cuid())
  userID          String
  content         String     @db.VarChar(255)
  directMessageID String
  directMessage   DM         @relation(fields: [directMessageID], references: [id])
  user            User       @relation(fields: [userID], references: [id])
  reactions       Reaction[]

  @@index([directMessageID], map: "message_directMessageID_fkey")
  @@index([userID], map: "message_userID_fkey")
  @@map("message")
}

model Comment {
  id        String     @id @default(cuid())
  userID    String
  content   String     @db.VarChar(255)
  postID    String
  post      Post       @relation(fields: [postID], references: [id])
  user      User       @relation(fields: [userID], references: [id])
  reactions Reaction[]

  @@index([postID], map: "comment_postID_fkey")
  @@index([userID], map: "comment_userID_fkey")
  @@map("comment")
}

model Reaction {
  id        String   @id @default(cuid())
  name      String
  count     Int      @default(1)
  commentID String?
  messageID String?
  comment   Comment? @relation(fields: [commentID], references: [id])
  message   Message? @relation(fields: [messageID], references: [id])

  @@index([commentID], map: "reaction_commentID_fkey")
  @@index([messageID], map: "reaction_messageID_fkey")
  @@map("reaction")
}

model BannedRefreshTokens {
  id           String @id @default(cuid())
  refreshToken String @unique @db.VarChar(512)

  @@map("banned_refresh_token")
}
